# replace zappi_XXXXXXXX with your zappi regno
# replace z_ZZZZZZZZ with your octopus account
# v5.6.0 Tweaks to go with release
# v5.4.1 Tweaks to go with release
# v5.3.0 Minor update to show hide charge period 2 when the switch is enabled
# v5.0.1 Minor update to include Export Margin Delta (min)
# v5.0   Refactored
# v4.0.  Predicted production using Solcast
#        Added a Battery SoH sensor to help discharge pridictions
#        Added a predicted Shcedule start time based on EV battery size
# v3.8   Added function to estimate what time EV needs to start based on % charge required and target time
# v3.7   Added pre emptive discharge options
# v3.2.2 Added switches to hide/unhide bits of the dashboard
# v3.2.1 Added house load power to the Heading Card
# v3.2   Dashboard tidy
# v3.1   Added better notification options and cell voltage
#        Added Solax System On/Off
# v3.0.5 Added missing titles to load chart
# v3.0.4 Tidy up of charts
# v3.0.3 Chart presentation improvement
# v3.0.1 Added new charting params
# v3.0.0 Various enhancments to go with the release
type: sections
max_columns: 3
title: Solax & Octopus Settings
path: solax-settings
sections:
  - type: grid
    cards:
      - type: heading
        heading_style: title
        badges:
          - type: entity
            show_state: true
            show_icon: true
            entity: sensor.zappi_plug_status
            color: green
            visibility:
              - condition: state
                entity: sensor.zappi_plug_status
                state_not: EV Disconnected
            tap_action:
              action: more-info
          - type: entity
            show_state: true
            show_icon: true
            entity: sensor.octopus_total_planned_dispatch
            name: Planned Dispatch
            state_content:
              - name
              - state
            color: green
            tap_action:
              action: more-info
          - type: entity
            show_state: true
            show_icon: false
            entity: sensor.octopus_completed_dispatch
            name: Completed
            visibility:
              - condition: state
                entity: binary_sensor.octopus_intelligent_dispatching
                state: "on"
              - condition: state
                entity: sensor.zappi_plug_status
                state: EV Connected
            tap_action:
              action: more-info
            state_content:
              - name
              - state
          - type: entity
            show_state: true
            show_icon: true
            entity: sensor.octopus_completed_dispatch
            visibility:
              - condition: state
                entity: sensor.zappi_plug_status
                state: Charging
            tap_action:
              action: more-info
            state_content:
              - name
              - state
            name: Completed
      - type: markdown
        content: >-
          {% if state_attr('sensor.octopus_total_planned_dispatch','dispatches')
          != None%}    

          Planned Dispatches

          {% set current =
          state_attr('sensor.octopus_total_planned_dispatch','dispatches')|list|
          map(attribute='dispatch') | list %}
            {% for dispatch in current%}
              {{dispatch}}
            {% endfor %}
          {%endif%}
        visibility:
          - condition: numeric_state
            entity: sensor.octopus_total_planned_dispatch
            above: 0
      - type: entities
        entities:
          - entity: input_boolean.octopus_schedule_anytime
            state_color: true
          - entity: input_boolean.use_clever_time
            state_color: true
          - entity: input_boolean.use_fixed_time
            state_color: true
          - entity: input_boolean.solar_export_priority
            state_color: true
        show_header_toggle: false
        state_color: true
        title: Octopus Schedule Type
        visibility:
          - condition: state
            entity: input_boolean.solax_octopus_hide_settings
            state: "on"
      - type: conditional
        conditions:
          - condition: state
            entity: input_boolean.solax_octopus_hide_settings
            state: "off"
        card:
          type: entities
          entities:
            - type: conditional
              conditions:
                - entity: binary_sensor.free_electricity_today
                  state_not: "off"
                - entity: input_boolean.octopus_free_electric_soc_use
                  state_not: "on"
              row:
                entity: input_datetime.octopus_free_electricity_prep
                format: time
            - type: conditional
              conditions:
                - entity: input_boolean.export_battery_daily
                  state_not: "off"
                - entity: sensor.zappi_plug_status
                  state: EV Disconnected
              row:
                entity: sensor.daily_battery_export_time_ev_disconnected
                format: time
            - type: conditional
              conditions:
                - entity: sensor.zappi_plug_status
                  state: EV Connected
              row:
                entity: sensor.ev_start_time
                format: time
            - type: conditional
              conditions:
                - entity: input_boolean.export_battery_prior
                  state_not: "off"
                - entity: binary_sensor.solax_battery_export_before_ev_charge_allowed
                  state: "on"
              row:
                entity: sensor.pre_export_battery_before_charging_ev_time
                format: time
            - type: conditional
              conditions:
                - entity: input_boolean.export_battery
                  state_not: "off"
                - entity: sensor.zappi_plug_status
                  state: EV Disconnected
              row:
                entity: sensor.pre_nightly_battery_export_time
                format: time
            - type: conditional
              conditions:
                - entity: binary_sensor.solax_discharge_daily
                  state: "on"
              row:
                entity: binary_sensor.solax_discharge_daily
            - type: conditional
              conditions:
                - entity: binary_sensor.solax_discharge_before_ev_charge
                  state: "on"
              row:
                entity: binary_sensor.solax_discharge_before_ev_charge
            - type: conditional
              conditions:
                - entity: binary_sensor.solax_discharge_before_2330
                  state: "on"
              row:
                entity: binary_sensor.solax_discharge_before_2330
            - type: conditional
              conditions:
                - entity: binary_sensor.solax_discharge_nightly
                  state: "on"
              row:
                entity: binary_sensor.solax_discharge_nightly
            - type: conditional
              conditions:
                - entity: binary_sensor.solax_discharge_free_electric_prep
                  state: "on"
              row:
                entity: binary_sensor.solax_discharge_free_electric_prep
      - type: conditional
        conditions:
          - condition: state
            entity: input_boolean.solar_export_priority
            state: "on"
          - condition: state
            entity: input_boolean.solax_octopus_hide_settings
            state: "on"
        card:
          type: entities
          entities:
            - entity: sensor.ev_start_time
              format: time
            - entity: input_number.sun_degrees_above_horizon
            - entity: number.octopus_intelligent_charge_target
            - entity: select.octopus_intelligent_target_time
          title: Schedule After Sunset
      - type: conditional
        conditions:
          - condition: state
            entity: input_boolean.octopus_schedule_anytime
            state: "on"
          - condition: state
            entity: input_boolean.solax_octopus_hide_settings
            state: "on"
        card:
          type: entities
          entities:
            - entity: sensor.ev_start_time
              format: time
            - entity: number.octopus_intelligent_charge_target
            - entity: select.octopus_intelligent_target_time
          title: Schedule Anytime
      - type: conditional
        conditions:
          - condition: state
            entity: input_boolean.use_clever_time
            state: "on"
          - condition: state
            entity: input_boolean.solax_octopus_hide_settings
            state: "on"
        card:
          type: entities
          entities:
            - entity: sensor.ev_start_time
              format: time
            - entity: input_number.ev_battery_size
            - entity: number.octopus_intelligent_charge_target
            - entity: select.octopus_intelligent_target_time
          title: Single Dispatch
      - type: conditional
        conditions:
          - condition: and
            conditions:
              - condition: state
                entity: input_boolean.solar_export_priority
                state: "off"
              - condition: state
                entity: input_boolean.octopus_schedule_anytime
                state: "off"
              - condition: state
                entity: input_boolean.use_clever_time
                state: "off"
          - condition: state
            entity: input_boolean.solax_octopus_hide_settings
            state: "on"
        card:
          type: entities
          entities:
            - entity: sensor.ev_start_time
              format: time
            - entity: input_datetime.don_t_charge_ev_before_time
            - entity: number.octopus_intelligent_charge_target
            - entity: select.octopus_intelligent_target_time
          title: Schedule After Fixed Time
      - type: entities
        entities:
          - entity: input_boolean.zappi_eco_always
          - entity: number.zappi_minimum_green_level
        show_header_toggle: false
        state_color: true
        title: Eco Settings
        visibility:
          - condition: state
            entity: input_boolean.solax_octopus_hide_settings
            state: "on"
      - type: entities
        entities:
          - entity: automation.solax_zappi_octopus_control
          - entity: input_number.delay_when_ev_connected
          - entity: switch.octopus_intelligent_smart_charge
          - entity: select.zappi_charge_mode
        show_header_toggle: false
        state_color: true
        title: Device Status - 5001 Controlled
        visibility:
          - condition: state
            entity: input_boolean.solax_octopus_hide_settings
            state: "on"
      - type: vertical-stack
        cards:
          - type: entities
            entities:
              - entity: input_boolean.solax_zappi_octopus_control_notifications
                name: Notifications
                state_color: true
              - entity: input_select.solax_automation_notification_devices
              - entity: input_button.solax_zappi_octopus_reset_device_list
              - entity: input_select.solax_zappi_octopus_notification_list
              - entity: input_button.solax_zappi_octopus_reset_notification_exclusions
            title: Notification Management
          - type: markdown
            content: >
              {% set list = namespace( members =
              state_attr('sensor.solax_zappi_octopus_notification_to_exclude',
              'notification_list') | map(attribute='notification') | list) %}


              {% set devicelist = namespace( members =
              state_attr('sensor.solax_zappi_octopus_devices_to_notify',
              'mobile_devices') | map(attribute='device') | list) %}


              {% if
              states('input_boolean.solax_zappi_octopus_control_notifications')
              == 'on' %}


              **Mobile Devices to Notify:**



              {% for devices in devicelist.members -%}

              {{devices}}

              {%endfor %}


              {% if list.members|length >= 1%}

              **Excluded Notifications:**

              {% endif %}


              {% for notification in list.members -%}

              {{notification}}

              {%endfor %}


              {% endif %}
                
            layout_options:
              grid_columns: 4
              grid_rows: 1
        visibility:
          - condition: state
            entity: input_boolean.solax_octopus_hide_settings
            state: "on"
  - type: grid
    cards:
      - type: heading
        heading_style: title
        badges:
          - type: entity
            show_state: false
            show_icon: true
            entity: input_boolean.solax_automation_running
            color: pink
            tap_action:
              action: more-info
          - type: entity
            show_state: true
            show_icon: true
            entity: sensor.solax_local_house_load_power
            state_content:
              - name
              - state
            name: House Load
            color: light-green
            tap_action:
              action: more-info
          - type: entity
            show_state: true
            show_icon: true
            entity: sensor.solax_local_battery_soc
            state_content:
              - name
              - state
            color: green
            name: Battery
            tap_action:
              action: more-info
          - type: entity
            show_state: true
            show_icon: true
            entity: sensor.solax_local_battery_temperature
            tap_action:
              action: more-info
            name: Battery Temp
            state_content:
              - name
              - state
      - type: custom:power-flow-card-plus
        entities:
          battery:
            entity: sensor.solax_local_battery_power
            state_of_charge: sensor.solax_local_battery_soc
            invert_state: true
          grid:
            entity:
              consumption: sensor.solax_local_grid_used_power
              production: sensor.solax_local_grid_export_power
          home:
            entity: sensor.solax_local_load_power
            color_value: true
            name: Home
            use_metadata: true
            override_state: true
          individual:
            - entity: sensor.zappi_power_ct_internal_load
              secondary_info: {}
              name: Zappi
              use_metadata: false
              display_zero: true
          fossil_fuel_percentage:
            state_type: power
            entity: sensor.electricity_maps_grid_fossil_fuel_percentage
            color_value: true
            color_icon: true
            display_zero: true
            name: Low Carbon
            unit_white_space: true
            use_metadata: true
            display_zero_state: false
          solar:
            entity: sensor.solax_local_pv_output
            color_value: true
            color_icon: true
        clickable_entities: true
        display_zero_lines:
          mode: transparency
          transparency: 50
          grey_color:
            - 189
            - 189
            - 189
        use_new_flow_rate_model: true
        w_decimals: 0
        kw_decimals: 1
        min_flow_rate: 0.75
        max_expected_power: 6000
        min_expected_power: 0.01
        watt_threshold: 1000
        transparency_zero_lines: 0
        max_flow_rate: 10
        grid_options:
          columns: 12
          rows: auto
      - title: Solax Controls/Default Behaviours
        type: entities
        show_header_toggle: false
        entities:
          - entity: input_boolean.solax_system_enable
            name: Inverter Off/On
            state_color: true
          - entity: input_select.solax_work_mode
          - entity: input_boolean.solax_can_see_zappi_loads
          - entity: input_boolean.use_grid_during_octopus_dispatch
            state_color: true
          - entity: input_boolean.ev_solax_battery_drain
            state_color: true
          - entity: input_select.solax_default_mode
          - entity: input_number.solax_default_discharge_limit_soc
          - entity: input_number.solax_default_charge_to_limit_soc
          - entity: input_number.solax_battery_capacity
          - entity: input_number.solax_inverter_capacity
        grid_options:
          columns: 15
          rows: auto
        state_color: true
        visibility:
          - condition: state
            entity: input_boolean.solax_octopus_hide_settings
            state: "on"
      - title: Self Use Mode Settings
        type: entities
        show_header_toggle: false
        entities:
          - entity: input_number.solax_selfuse_battery_min_soc
          - entity: input_number.solax_selfuse_charge_to_soc
          - entity: input_datetime.solax_battery_start_discharge_time
          - entity: input_datetime.solax_battery_stop_discharge_time
          - entity: input_boolean.self_use_enable_charge_from_grid
            state_color: true
          - entity: input_datetime.solax_battery_start_charge_time
          - entity: input_datetime.solax_battery_stop_charge_time
          - entity: input_boolean.solaxchargeperiod2
            state_color: true
        state_color: true
        visibility:
          - condition: state
            entity: input_select.solax_work_mode
            state: Self Use
          - condition: state
            entity: input_boolean.solax_octopus_hide_settings
            state: "on"
      - title: Feed In Mode Settings
        type: entities
        entities:
          - entity: input_number.solax_feed_in_battery_min_soc
          - entity: input_number.solax_feed_in_charge_to_soc
          - entity: input_datetime.solax_battery_start_discharge_time
          - entity: input_datetime.solax_battery_stop_discharge_time
          - entity: input_datetime.solax_battery_start_charge_time
          - entity: input_datetime.solax_battery_stop_charge_time
          - entity: input_boolean.solaxchargeperiod2
            state_color: true
        visibility:
          - condition: state
            entity: input_select.solax_work_mode
            state: Feed In Priority
          - condition: state
            entity: input_boolean.solax_octopus_hide_settings
            state: "on"
      - type: entities
        show_header_toggle: false
        entities:
          - entity: input_datetime.solax_start_charge_2
          - entity: input_datetime.solax_stop_charge_2
        visibility:
          - condition: or
            conditions:
              - condition: state
                entity: binary_sensor.free_electricity_today
                state: "on"
              - condition: state
                entity: input_boolean.solaxchargeperiod2
                state: "on"
      - type: entities
        show_header_toggle: false
        entities:
          - entity: sensor.solax_local_inverter_mode
          - entity: sensor.solax_local_manual_mode_behaviour
          - entity: input_select.solax_manual_modes
        title: Manual Mode Settings
        header:
          type: graph
          entity: sensor.solax_local_battery_dump_power
          detail: 2
          hours_to_show: 24
        visibility:
          - condition: state
            entity: input_select.solax_work_mode
            state: Manual
      - title: Battery Heating (read-only)
        type: entities
        show_header_toggle: false
        entities:
          - entity: input_boolean.battery_heat_enable
            state_color: true
        grid_options:
          columns: 15
          rows: auto
        visibility:
          - condition: state
            entity: input_boolean.solax_octopus_hide_settings
            state: "on"
      - type: entities
        show_header_toggle: false
        entities:
          - entity: input_select.solax_battery_heat_level
          - entity: input_datetime.solax_battery_start_heat_time
          - entity: input_datetime.solax_battery_stop_heat_time
          - entity: input_datetime.solax_start_heat_2
          - entity: input_datetime.solax_stop_heat_2
        visibility:
          - condition: state
            entity: input_boolean.battery_heat_enable
            state: "on"
          - condition: state
            entity: input_boolean.solax_octopus_hide_settings
            state: "on"
        grid_options:
          columns: 15
          rows: auto
    column_span: 1
  - type: grid
    cards:
      - type: heading
        heading_style: title
        badges:
          - type: entity
            show_state: true
            show_icon: false
            entity: sensor.solcast_pv_forecast_forecast_remaining_today
            tap_action:
              action: more-info
            state_content:
              - name
              - state
            name: Forecast
          - type: entity
            show_state: true
            show_icon: false
            entity: sensor.solax_local_pv_output
            color: green
            state_content:
              - name
              - state
            name: PV
            tap_action:
              action: more-info
          - type: entity
            show_state: true
            show_icon: false
            entity: sensor.solax_local_inverter_power
            name: Inverter Power
            state_content:
              - name
              - state
            color: accent
            tap_action:
              action: more-info
          - type: entity
            show_state: true
            show_icon: false
            entity: sensor.solax_local_grid_export_power
            name: Export
            state_content:
              - name
              - state
            color: accent
            tap_action:
              action: more-info
        tap_action:
          action: none
      - type: entities
        entities:
          - entity: binary_sensor.solax_battery_export_before_ev_charge_allowed
          - entity: input_boolean.pre_emptive_export_battery
            state_color: true
          - type: conditional
            conditions:
              - entity: input_boolean.pre_emptive_export_battery
                state_not: "off"
            row:
              entity: input_number.battery_export_margin_delta
              format: time
          - type: conditional
            conditions:
              - entity: input_boolean.pre_emptive_export_battery
                state_not: "off"
            row:
              entity: input_number.solax_battery_soh_stored
              format: time
          - type: conditional
            conditions:
              - entity: input_boolean.export_battery_daily
                state_not: "off"
            row:
              entity: sensor.daily_battery_export_time_ev_disconnected
              format: time
          - type: conditional
            conditions:
              - entity: input_boolean.export_battery_prior
                state_not: "off"
            row:
              entity: sensor.pre_export_battery_before_charging_ev_time
              format: time
          - type: conditional
            conditions:
              - entity: input_boolean.export_battery
                state_not: "off"
              - entity: sensor.zappi_plug_status
                state: EV Disconnected
            row:
              entity: sensor.pre_nightly_battery_export_time
              format: time
        title: Solax Battery Exports
        show_header_toggle: false
        state_color: true
        visibility:
          - condition: state
            entity: input_boolean.solax_octopus_hide_settings
            state: "on"
      - type: entities
        entities:
          - type: conditional
            conditions:
              - entity: binary_sensor.solax_discharge_daily
                state: "on"
            row:
              entity: binary_sensor.solax_discharge_daily
          - type: conditional
            conditions:
              - entity: binary_sensor.solax_discharge_before_ev_charge
                state: "on"
            row:
              entity: binary_sensor.solax_discharge_before_ev_charge
          - type: conditional
            conditions:
              - entity: binary_sensor.solax_discharge_before_2330
                state: "on"
            row:
              entity: binary_sensor.solax_discharge_before_2330
          - type: conditional
            conditions:
              - entity: binary_sensor.solax_discharge_nightly
                state: "on"
            row:
              entity: binary_sensor.solax_discharge_nightly
          - type: conditional
            conditions:
              - entity: binary_sensor.solax_discharge_manual
                state: "on"
            row:
              entity: binary_sensor.solax_discharge_manual
          - type: conditional
            conditions:
              - entity: binary_sensor.solax_discharge_free_electric_prep
                state: "on"
            row:
              entity: binary_sensor.solax_discharge_free_electric_prep
        title: Exporting Status
        visibility:
          - condition: or
            conditions:
              - condition: state
                entity: binary_sensor.solax_discharge_before_2330
                state: "on"
              - condition: state
                entity: binary_sensor.solax_discharge_free_electric_prep
                state: "on"
              - condition: state
                entity: binary_sensor.solax_discharge_nightly
                state: "on"
              - condition: state
                entity: binary_sensor.solax_discharge_before_ev_charge
                state: "on"
              - condition: state
                entity: binary_sensor.solax_discharge_daily
                state: "on"
              - condition: state
                entity: binary_sensor.solax_discharge_manual
                state: "on"
      - type: entities
        entities:
          - entity: input_boolean.export_battery_prior
          - type: conditional
            conditions:
              - entity: input_boolean.export_battery_prior
                state_not: "off"
            row:
              entity: input_number.solax_discharge_limit_soc_before_ev
          - type: conditional
            conditions:
              - entity: input_boolean.export_battery_prior
                state_not: "off"
            row:
              entity: input_boolean.priorise_export_over_ev
        title: Export Before Charging EV
        show_header_toggle: false
        state_color: true
        visibility:
          - condition: state
            entity: input_boolean.solax_octopus_hide_settings
            state: "on"
      - type: entities
        entities:
          - entity: input_boolean.export_battery_daily
          - type: conditional
            conditions:
              - entity: input_boolean.export_battery_daily
                state_not: "off"
            row:
              entity: input_datetime.daily_battery_export_time
          - type: conditional
            conditions:
              - entity: input_boolean.export_battery_daily
                state_not: "off"
            row:
              entity: input_number.solax_daily_discharge_limit_soc
        title: Daily Export
        show_header_toggle: false
        state_color: true
        visibility:
          - condition: state
            entity: input_boolean.solax_octopus_hide_settings
            state: "on"
      - type: entities
        entities:
          - entity: input_boolean.export_battery
          - type: conditional
            conditions:
              - entity: input_boolean.export_battery
                state_not: "off"
            row:
              entity: input_number.solax_manual_forced_discharge_limit_soc
        title: Nightly Export
        show_header_toggle: false
        state_color: true
        visibility:
          - condition: state
            entity: input_boolean.solax_octopus_hide_settings
            state: "on"
      - type: entities
        entities:
          - entity: input_number.solax_manual_forced_discharge_limit_soc
          - entity: input_button.solax_force_discharge
          - entity: input_button.solax_stop_discharge
        title: Force Discharge
        show_header_toggle: false
        state_color: true
        visibility:
          - condition: state
            entity: input_boolean.solax_octopus_hide_settings
            state: "on"
      - type: entities
        entities:
          - entity: automation.octopus_free_electric_automation
        state_color: true
        visibility:
          - condition: state
            entity: input_boolean.solax_octopus_hide_settings
            state: "on"
      - type: conditional
        conditions:
          - condition: or
            conditions:
              - condition: and
                conditions:
                  - condition: or
                    conditions:
                      - condition: state
                        entity: binary_sensor.upcoming_free_electricity
                        state: "on"
                      - condition: state
                        entity: binary_sensor.free_electricity_today
                        state: "on"
                  - condition: state
                    entity: input_boolean.solax_octopus_hide_settings
                    state: "off"
              - condition: and
                conditions:
                  - condition: state
                    entity: automation.octopus_free_electric_automation
                    state: "on"
                  - condition: state
                    entity: input_boolean.solax_octopus_hide_settings
                    state: "on"
        card:
          type: entities
          entities:
            - entity: input_datetime.octopus_free_electricity_start
            - entity: sensor.octopus_free_electricity_stop
              secondary_info: none
              format: time
            - entity: input_boolean.octopus_free_electric_soc_use
            - entity: input_number.octopus_free_session_battery_prep_soc
            - entity: input_datetime.octopus_free_electricity_prep
            - entity: binary_sensor.free_electricity_today
    column_span: 1
  - type: grid
    cards:
      - type: history-graph
        entities:
          - entity: select.daily_grid_import
            name: Log
          - entity: binary_sensor.octopus_intelligent_dispatching
          - entity: binary_sensor.solax_local_battery_charging_period
          - entity: sensor.solax_local_inverter_mode
          - entity: sensor.solax_local_manual_mode_behaviour
          - entity: sensor.zappi_plug_status
          - entity: sensor.solax_runmode
        fit_y_data: true
        hours_to_show: 36
        grid_options:
          columns: 36
          rows: auto
      - type: heading
        heading_style: title
        badges:
          - type: entity
            show_state: false
            show_icon: true
            entity: input_boolean.solax_automation_running
            color: pink
          - type: entity
            show_state: true
            show_icon: true
            entity: sensor.solax_local_battery_soc
            state_content:
              - name
              - state
            color: green
            name: Battery
            tap_action:
              action: more-info
          - type: entity
            show_state: true
            show_icon: true
            entity: sensor.solax_local_battery_temperature
            tap_action:
              action: more-info
            state_content:
              - name
              - state
            name: Battery Temp
          - type: entity
            show_state: true
            show_icon: true
            entity: sensor.solax_local_pv_output
            color: green
            state_content:
              - name
              - state
            name: PV
            tap_action:
              action: more-info
          - type: entity
            show_state: true
            show_icon: true
            entity: sensor.solax_local_inverter_power
            name: Inverter Power
            state_content:
              - name
              - state
            color: accent
            tap_action:
              action: more-info
          - type: entity
            show_state: true
            show_icon: true
            entity: sensor.solax_local_house_load_power
            name: House Load
            tap_action:
              action: more-info
            state_content:
              - name
              - state
          - type: entity
            show_state: true
            show_icon: true
            entity: sensor.solax_local_grid_export_power
            name: Export
            state_content:
              - name
              - state
            color: green
            tap_action:
              action: more-info
          - type: entity
            show_state: true
            show_icon: true
            entity: sensor.solax_local_grid_power
            color: red
            state_content:
              - name
              - state
            tap_action:
              action: more-info
            name: Grid Power
      - title: Solax Energy
        type: history-graph
        hours_to_show: 36
        entities:
          - entity: sensor.daily_total_stored
          - entity: sensor.daily_grid_stored
          - entity: sensor.daily_solar_stored
          - entity: sensor.daily_battery_use
          - entity: sensor.daily_self_consumed
          - entity: sensor.daily_house_load
          - entity: sensor.daily_manual_battery_export
          - entity: sensor.export_daily
          - entity: sensor.solax_discharge_capacity
          - entity: sensor.solcast_pv_forecast_forecast_remaining_today
        grid_options:
          columns: 36
          rows: auto
        fit_y_data: true
      - type: history-graph
        entities:
          - entity: select.daily_grid_import
            name: Log
        fit_y_data: true
        hours_to_show: 36
        grid_options:
          columns: 36
          rows: auto
    column_span: 3
    visibility:
      - condition: state
        entity: input_boolean.solax_octopus_hide_energy
        state: "on"
  - cards:
      - type: heading
        heading_style: title
        badges:
          - type: entity
            show_state: false
            show_icon: true
            entity: input_boolean.solax_automation_running
            color: pink
          - type: entity
            show_state: true
            show_icon: true
            entity: sensor.solax_local_battery_soc
            state_content:
              - name
              - state
            color: green
            name: Battery
            tap_action:
              action: more-info
          - type: entity
            show_state: true
            show_icon: true
            entity: sensor.solax_local_battery_temperature
            tap_action:
              action: more-info
            state_content:
              - name
              - state
            name: Battery Temp
          - type: entity
            show_state: true
            show_icon: true
            entity: sensor.solax_local_pv_output
            color: green
            state_content:
              - name
              - state
            name: PV
            tap_action:
              action: more-info
          - type: entity
            show_state: true
            show_icon: true
            entity: sensor.solax_local_inverter_power
            name: Inverter Power
            state_content:
              - name
              - state
            color: accent
            tap_action:
              action: more-info
          - type: entity
            show_state: true
            show_icon: true
            entity: sensor.solax_local_house_load_power
            name: House Load
            tap_action:
              action: more-info
            state_content:
              - name
              - state
          - type: entity
            show_state: true
            show_icon: true
            entity: sensor.solax_local_grid_export_power
            name: Export
            state_content:
              - name
              - state
            color: green
            tap_action:
              action: more-info
          - type: entity
            show_state: true
            show_icon: true
            entity: sensor.solax_local_grid_power
            color: red
            state_content:
              - name
              - state
            tap_action:
              action: more-info
            name: Grid Power
        heading: Power Sensors
      - title: Solax Power
        type: history-graph
        hours_to_show: 36
        entities:
          - entity: sensor.solax_local_battery_use_in
          - entity: sensor.solax_local_battery_use_in_from_grid
          - entity: sensor.solax_local_battery_in_from_solar
          - entity: sensor.solax_local_battery_power_adjusted
          - entity: sensor.solax_local_self_consumption_power
          - entity: sensor.solax_local_house_load_power
          - entity: sensor.solax_local_battery_dump_power
          - entity: sensor.solax_local_grid_export_power
          - entity: sensor.solax_local_inverter_in_power
        grid_options:
          columns: 36
          rows: auto
      - type: history-graph
        entities:
          - entity: select.daily_grid_import
            name: Log
        fit_y_data: true
        hours_to_show: 36
        grid_options:
          columns: 36
          rows: auto
      - title: SoC
        type: history-graph
        hours_to_show: 36
        entities:
          - entity: sensor.solax_local_selfuse_battery_min_soc
          - entity: sensor.solax_local_feed_in_battery_min_soc
          - entity: sensor.solax_local_selfuse_battery_chrg_frm_grd_to
          - entity: sensor.solax_local_feed_in_battery_charge_from_grid_to
          - entity: input_number.solax_default_charge_to_limit_soc
          - entity: input_number.solax_default_discharge_limit_soc
          - entity: input_number.solax_manual_forced_discharge_limit_soc
          - entity: input_number.solax_discharge_limit_soc_before_ev
          - entity: sensor.solax_local_battery_soc
          - entity: input_number.solax_daily_discharge_limit_soc
          - entity: input_number.solax_nightly_discharge_limit_soc
        grid_options:
          columns: 36
          rows: auto
      - type: history-graph
        entities:
          - entity: select.daily_grid_import
            name: Log
        fit_y_data: true
        hours_to_show: 36
        grid_options:
          columns: 36
          rows: auto
      - type: history-graph
        entities:
          - entity: sensor.solax_local_load_power
          - entity: sensor.solax_local_grid_power
          - entity: sensor.solax_local_inverter_power
          - entity: sensor.solax_local_pv_output
          - entity: sensor.solax_local_pv_output_string_1
          - entity: sensor.solax_local_pv_output_string_2
          - entity: sensor.solcast_pv_forecast_power_now
          - entity: sensor.zappi_power_ct_internal_load
        grid_options:
          columns: 36
          rows: auto
        hours_to_show: 36
        title: Load In/Out
      - type: history-graph
        entities:
          - entity: select.daily_grid_import
            name: Log
          - entity: sensor.solax_local_inverter_mode
          - entity: sensor.solax_local_manual_mode_behaviour
          - entity: sensor.zappi_plug_status
          - entity: sensor.solax_runmode
        fit_y_data: true
        hours_to_show: 36
        grid_options:
          columns: 36
          rows: auto
      - title: Cell Voltage (Pack Voltage/X cells)
        type: history-graph
        hours_to_show: 36
        entities:
          - entity: sensor.solax_local_battery_cell_voltage
        grid_options:
          columns: 36
          rows: auto
        min_y_axis: 3
      - title: Battery Temperature
        type: history-graph
        hours_to_show: 36
        entities:
          - entity: sensor.solax_local_battery_temperature
        grid_options:
          columns: 36
          rows: auto
      - title: " Grid Stored/Theoretical Grid Stored= Capacity SoH"
        type: history-graph
        hours_to_show: 1500
        entities:
          - sensor.solax_local_battery_soh
          - sensor.solax_local_min_soc
          - sensor.solax_local_max_soc
        grid_options:
          columns: full
          rows: 8
    column_span: 3
    visibility:
      - condition: state
        entity: input_boolean.solax_octopus_hide_power
        state: "on"
  - type: grid
    cards:
      - type: heading
        heading: Energy Stats
        heading_style: title
      - type: vertical-stack
        cards:
          - type: statistic
            entity: sensor.monthly_grid_import_free
            period:
              calendar:
                period: day
            stat_type: change
            name: Free Import
          - type: statistic
            entity: sensor.monthly_grid_import_peak
            period:
              calendar:
                period: day
            stat_type: change
            name: Peak Import
          - type: statistic
            entity: sensor.monthly_grid_import_offpeak
            period:
              calendar:
                period: day
            stat_type: change
            name: Off peak Import
          - type: statistic
            entity: sensor.solax_local_inverter_aggregated_energy
            period:
              calendar:
                period: day
            stat_type: change
            name: Solar Yield
          - type: statistic
            entity: sensor.solax_local_grid_export_aggregated_energy
            period:
              calendar:
                period: day
            stat_type: change
            name: Total Export
          - type: statistic
            entity: sensor.solax_local_battery_dump_aggregated_energy
            period:
              calendar:
                period: day
            stat_type: change
            name: Forced Battery Export
          - type: statistic
            entity: sensor.zappi_charging
            period:
              calendar:
                period: day
            stat_type: change
            name: Zappi
          - type: statistic
            period:
              calendar:
                period: day
            stat_type: change
            name: House Usage
            entity: sensor.solax_local_house_load_aggregated_energy
          - type: statistic
            entity: sensor.solax_local_self_consumption_aggregated_energy
            period:
              calendar:
                period: day
            stat_type: change
            name: Solax Self Consumption
          - type: statistic
            entity: sensor.solax_local_battery_out_aggregated_energy
            period:
              calendar:
                period: day
            stat_type: change
            name: Battery Used for House
          - type: statistic
            entity: sensor.solax_local_battery_in_from_grid_aggregated_energy
            period:
              calendar:
                period: day
            stat_type: change
            name: DC Grid Stored
          - type: statistic
            entity: sensor.solax_local_battery_in_from_solar_aggregated_energy
            period:
              calendar:
                period: day
            stat_type: change
            name: Solar Stored
        title: Today
        grid_options:
          columns: 6
      - type: vertical-stack
        cards:
          - type: statistic
            entity: sensor.monthly_grid_import_free
            period:
              calendar:
                period: day
                offset: -1
            stat_type: change
            name: Free Import
          - type: statistic
            entity: sensor.monthly_grid_import_peak
            period:
              calendar:
                period: day
                offset: -1
            stat_type: change
            name: Peak Import
          - type: statistic
            entity: sensor.monthly_grid_import_offpeak
            period:
              calendar:
                period: day
                offset: -1
            stat_type: change
            name: Off peak Import
          - type: statistic
            entity: sensor.solax_local_inverter_aggregated_energy
            period:
              calendar:
                period: day
                offset: -1
            stat_type: change
            name: Solar Yield
          - type: statistic
            entity: sensor.solax_local_grid_export_aggregated_energy
            period:
              calendar:
                period: day
                offset: -1
            stat_type: change
            name: Total Export
          - type: statistic
            entity: sensor.solax_local_battery_dump_aggregated_energy
            period:
              calendar:
                period: day
                offset: -1
            stat_type: change
            name: Forced Battery Export
          - type: statistic
            entity: sensor.zappi_charging
            period:
              calendar:
                period: day
                offset: -1
            stat_type: change
            name: Zappi
          - type: statistic
            period:
              calendar:
                period: day
                offset: -1
            stat_type: change
            name: House Usage
            entity: sensor.solax_local_house_load_aggregated_energy
          - type: statistic
            entity: sensor.solax_local_self_consumption_aggregated_energy
            period:
              calendar:
                period: day
                offset: -1
            stat_type: change
            name: Solax Self Consumption
          - type: statistic
            entity: sensor.solax_local_battery_out_aggregated_energy
            period:
              calendar:
                period: day
                offset: -1
            stat_type: change
            name: Battery Used for House
          - type: statistic
            entity: sensor.solax_local_battery_in_from_grid_aggregated_energy
            period:
              calendar:
                period: day
                offset: -1
            stat_type: change
            name: DC Grid Stored
          - type: statistic
            entity: sensor.solax_local_battery_in_from_solar_aggregated_energy
            period:
              calendar:
                period: day
                offset: -1
            stat_type: change
            name: Solar Stored
        grid_options:
          columns: 6
        title: Yesterday
      - type: vertical-stack
        cards:
          - type: statistic
            entity: sensor.monthly_grid_import_free
            period:
              calendar:
                period: month
            stat_type: change
            name: Free Import
          - type: statistic
            entity: sensor.monthly_grid_import_peak
            period:
              calendar:
                period: month
            stat_type: change
            name: Peak Import
          - type: statistic
            entity: sensor.monthly_grid_import_offpeak
            period:
              calendar:
                period: month
            stat_type: change
            name: Off peak Import
          - type: statistic
            entity: sensor.solax_local_inverter_aggregated_energy
            period:
              calendar:
                period: month
                offset: 0
            stat_type: change
            name: Solar Yield
          - type: statistic
            entity: sensor.solax_local_grid_export_aggregated_energy
            period:
              calendar:
                period: month
            stat_type: change
            name: Total Export
          - type: statistic
            entity: sensor.solax_local_battery_dump_aggregated_energy
            period:
              calendar:
                period: month
            stat_type: change
            name: Forced Battery Export
          - type: statistic
            entity: sensor.zappi_charging
            period:
              calendar:
                period: month
            stat_type: change
            name: Zappi
          - type: statistic
            period:
              calendar:
                period: month
            stat_type: change
            name: House Usage
            entity: sensor.solax_local_house_load_aggregated_energy
          - type: statistic
            entity: sensor.solax_local_self_consumption_aggregated_energy
            period:
              calendar:
                period: month
            stat_type: change
            name: Solax Self Consumption
          - type: statistic
            entity: sensor.solax_local_battery_out_aggregated_energy
            period:
              calendar:
                period: month
            stat_type: change
            name: Battery Used for House
          - type: statistic
            entity: sensor.solax_local_battery_in_from_grid_aggregated_energy
            period:
              calendar:
                period: month
            stat_type: change
            name: DC Grid Stored
          - type: statistic
            entity: sensor.solax_local_battery_in_from_solar_aggregated_energy
            period:
              calendar:
                period: month
            stat_type: change
            name: Solar Stored
        grid_options:
          columns: 6
        title: This Month
      - type: vertical-stack
        cards:
          - type: statistic
            entity: sensor.monthly_grid_import_free
            period:
              calendar:
                period: month
                offset: -1
            stat_type: change
            name: Free Import
          - type: statistic
            entity: sensor.monthly_grid_import_peak
            period:
              calendar:
                period: month
                offset: -1
            stat_type: change
            name: Peak Import
          - type: statistic
            entity: sensor.monthly_grid_import_offpeak
            period:
              calendar:
                period: month
                offset: -1
            stat_type: change
            name: Off peak Import
          - type: statistic
            entity: sensor.solax_local_inverter_aggregated_energy
            period:
              calendar:
                period: month
                offset: -1
            stat_type: change
            name: Solar Yield
          - type: statistic
            entity: sensor.solax_local_grid_export_aggregated_energy
            period:
              calendar:
                period: month
                offset: -1
            stat_type: change
            name: Total Export
          - type: statistic
            entity: sensor.solax_local_battery_dump_aggregated_energy
            period:
              calendar:
                period: month
                offset: -1
            stat_type: change
            name: Forced Battery Export
          - type: statistic
            entity: sensor.zappi_charging
            period:
              calendar:
                period: month
                offset: -1
            stat_type: change
            name: Zappi
          - type: statistic
            period:
              calendar:
                period: month
                offset: -1
            stat_type: change
            name: House Usage
            entity: sensor.solax_local_house_load_aggregated_energy
          - type: statistic
            entity: sensor.solax_local_self_consumption_aggregated_energy
            period:
              calendar:
                period: month
                offset: -1
            stat_type: change
            name: Solax Self Consumption
          - type: statistic
            entity: sensor.solax_local_battery_out_aggregated_energy
            period:
              calendar:
                period: month
                offset: -1
            stat_type: change
            name: Battery Used for House
          - type: statistic
            entity: sensor.solax_local_battery_in_from_grid_aggregated_energy
            period:
              calendar:
                period: month
                offset: -1
            stat_type: change
            name: DC Grid Stored
          - type: statistic
            entity: sensor.solax_local_battery_in_from_solar_aggregated_energy
            period:
              calendar:
                period: month
                offset: -1
            stat_type: change
            name: Solar Stored
        grid_options:
          columns: 6
        title: Last Month
      - type: vertical-stack
        cards:
          - type: statistic
            entity: sensor.monthly_grid_import_free
            period:
              calendar:
                period: year
            stat_type: change
            name: Free Import
          - type: statistic
            entity: sensor.monthly_grid_import_peak
            period:
              calendar:
                period: year
            stat_type: change
            name: Peak Import
          - type: statistic
            entity: sensor.monthly_grid_import_offpeak
            period:
              calendar:
                period: year
            stat_type: change
            name: Off peak Import
          - type: statistic
            entity: sensor.solax_local_inverter_aggregated_energy
            period:
              calendar:
                period: year
            stat_type: change
            name: Solar Yield
          - type: statistic
            entity: sensor.solax_local_grid_export_aggregated_energy
            period:
              calendar:
                period: year
            stat_type: change
            name: Total Export
          - type: statistic
            entity: sensor.solax_local_battery_dump_aggregated_energy
            period:
              calendar:
                period: year
            stat_type: change
            name: Forced Battery Export
          - type: statistic
            entity: sensor.zappi_charging
            period:
              calendar:
                period: year
            stat_type: change
            name: Zappi
          - type: statistic
            period:
              calendar:
                period: year
            stat_type: change
            name: House Usage
            entity: sensor.solax_local_house_load_aggregated_energy
          - type: statistic
            entity: sensor.solax_local_self_consumption_aggregated_energy
            period:
              calendar:
                period: year
            stat_type: change
            name: Solax Self Consumption
          - type: statistic
            entity: sensor.solax_local_battery_out_aggregated_energy
            period:
              calendar:
                period: year
            stat_type: change
            name: Battery Used for House
          - type: statistic
            entity: sensor.solax_local_battery_in_from_grid_aggregated_energy
            period:
              calendar:
                period: year
            stat_type: change
            name: DC Grid Stored
          - type: statistic
            entity: sensor.solax_local_battery_in_from_solar_aggregated_energy
            period:
              calendar:
                period: year
            stat_type: change
            name: Solar Stored
        grid_options:
          columns: 6
        title: This Year
      - chart_type: bar
        period: month
        type: statistics-graph
        entities:
          - sensor.solax_local_grid_used_aggregated_energy
          - sensor.zappi_charging
          - sensor.solax_local_grid_export_aggregated_energy
          - sensor.solax_local_house_load_aggregated_energy
        stat_types:
          - change
        days_to_show: 366
        grid_options:
          columns: full
          rows: 8
        title: Stats Summary - Last 12 Months
      - chart_type: bar
        period: month
        type: statistics-graph
        entities:
          - sensor.solax_local_grid_used_aggregated_energy
          - sensor.zappi_charging
          - sensor.solax_local_grid_export_aggregated_energy
          - sensor.solax_local_house_load_aggregated_energy
          - sensor.solax_local_inverter_aggregated_energy
          - sensor.solax_local_battery_dump_aggregated_energy
          - sensor.solax_local_battery_in_from_solar_aggregated_energy
          - sensor.solax_local_self_consumption_aggregated_energy
        stat_types:
          - change
        days_to_show: 366
        grid_options:
          columns: full
          rows: 8
        title: Detailed Stats Summary - Last 12 Months
    column_span: 3
    visibility:
      - condition: state
        entity: input_boolean.solax_octopus_hide_stats
        state: "on"
cards: []
badges:
  - type: entity
    show_name: false
    show_state: false
    show_icon: true
    color: pink
    entity: input_boolean.solax_automation_running
    name: Automations Running
    tap_action:
      action: none
  - type: entity
    show_name: true
    show_state: false
    show_icon: true
    entity: input_boolean.solax_octopus_hide_settings
    tap_action:
      action: toggle
    name: Show/Hide Settings
  - type: entity
    show_name: true
    show_state: false
    show_icon: true
    entity: input_boolean.solax_octopus_hide_energy
    tap_action:
      action: toggle
  - type: entity
    show_name: true
    show_state: false
    show_icon: true
    entity: input_boolean.solax_octopus_hide_power
    tap_action:
      action: toggle
  - type: entity
    show_name: true
    show_state: false
    show_icon: true
    entity: input_boolean.solax_octopus_hide_stats
    show_entity_picture: false
    tap_action:
      action: toggle
dense_section_placement: true
icon: ""
subview: false
